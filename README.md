# Проектная работа "Веб-ларек"

## Ссылка на GitHub-проект

```
https://github.com/GeorgeSGN/web-larek-frontend.git
```

## Используемый стек

Для разработки проекта используются следующие технологии:

- **JavaScript** — основной язык разработки.
- **HTML** — разметка страниц.
- **CSS/SCSS** — стилизация пользовательского интерфейса.
- **Webpack** — сборка проекта.
- **Babel** — транспиляция современного JavaScript в совместимый с более старыми браузерами.

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Слои архитектуры

Проект построен по архитектуре **MVP (Model-View-Presenter)**, которая включает следующие слои:

### Слой "Модель"

Слой модели отвечает за управление данными, взаимодействие с API и их обработку.

### Слой "Представление"

Слой представления включает классы, отвечающие за отображение данных в интерфейсе и обработку взаимодействия с пользователем.

### Слой "Презентер"

Презентер является посредником между Моделью и Представлением. Он отвечает за обработку событий из Представления, взаимодействие с Моделью и передачу данных обратно в Представление. Презентер реализуется в основном скрипте приложения, без выделения в отдельный класс.

---

## Описание классов

### Слой "Модель"

#### Класс `Api`

- **Назначение**:  
  Класс `Api` отвечает за взаимодействие с сервером через REST API. Реализует универсальные методы для отправки HTTP-запросов (GET, POST, и другие) и обработки ответов.

- **Конструктор**:  
  Принимает следующие параметры:

  - `baseUrl` (string) — базовый URL для всех запросов.
  - `options` (RequestInit, необязательный) — дополнительные параметры запроса, такие как заголовки, передаваемые в `RequestInit`. Эти параметры могут быть расширены при необходимости.

  В конструкторе создаются настройки запроса с заголовком `Content-Type: application/json` и объединяются с переданными в `options`.

- **Поля класса**:

  - `baseUrl` (string) — базовый URL для API.
  - `options` (RequestInit) — объект с настройками по умолчанию для запросов, который может быть расширен или изменен.

- **Методы класса**:
  - `get(uri: string): Promise<object>`  
    Отправляет GET-запрос на указанный URI. Возвращает Promise с распарсенным JSON-ответом.
  - `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`  
    Отправляет POST-запрос (или PUT/DELETE, если указано) с телом `data`. Возвращает Promise с результатом.
  - `handleResponse(response: Response): Promise<object>`  
    Обрабатывает ответ сервера. Если запрос успешен, возвращает распарсенный JSON, иначе отклоняет Promise с ошибкой.

---

#### Класс `EventEmitter`

- **Назначение**:  
  Класс `EventEmitter` реализует брокер событий, который используется в слое Модели для управления событиями, связанными с изменением данных и взаимодействием между слоями Модели и Представления. Позволяет подписываться на события, генерировать события и уведомлять о них другие компоненты.

- **Конструктор**:  
  Создает внутреннее поле `_events`, которое хранит карту событий и их подписчиков. Это поле инициализируется как пустая карта, где ключами являются названия событий, а значениями — множества обработчиков.

- **Поля класса**:

  - `_events` (Map<EventName, Set<Subscriber>>) — карта, где ключами являются названия событий (строка или регулярное выражение), а значениями — множества обработчиков событий.

- **Методы класса**:
  - `on<T extends object>(eventName: EventName, callback: (event: T) => void): void`  
    Добавляет обработчик `callback` для события `eventName`.
  - `off(eventName: EventName, callback: Subscriber): void`  
    Удаляет обработчик `callback` для события `eventName`. Если у события не осталось подписчиков, оно удаляется.
  - `emit<T extends object>(eventName: string, data?: T): void`  
    Инициирует событие `eventName`, передавая в него данные `data`. Вызывает все подписанные обработчики.
  - `onAll(callback: (event: EmitterEvent) => void): void`  
    Добавляет обработчик, который будет вызван для всех событий.
  - `offAll(): void`  
    Удаляет все обработчики для всех событий.
  - `trigger<T extends object>(eventName: string, context?: Partial<T>): (event: T) => void`  
    Создает функцию, которая при вызове инициирует событие `eventName` с переданными данными `context`.

---

#### Класс Catalog

- **Назначение**:  
  Управляет данными каталога товаров. Отвечает за хранение, обновление и предоставление данных о товарах.

- **Конструктор**:  
  Инициализирует класс с пустым массивом товаров.

```typescript
constructor() {
    this.products = [];
}
```

- **Поля класса**:

  - `products: Product []` — массив объектов товаров. Каждый объект `Product` представляет данные одного товара.

- **Методы класса**:

  - `setProducts(products: Product[]): void`  
    Устанавливает список товаров в каталог.

  - `getProducts(): Product[]`  
    Возвращает текущий массив объектов товаров из каталога.

---

#### Класс Cart

- **Назначение**:  
  Управляет данными корзины, включая добавление, удаление и вычисление итоговой стоимости товаров.

- **Конструктор**:  
  Инициализирует класс с пустым массивом товаров в корзине.

```typescript
constructor() {
    this.items = [];
}
```

- **Поля класса**:

  - `items: CartItem[]` — массив объектов корзины. Каждый объект `CartItem` содержит данные о товаре.

- **Методы класса**:

  - `addItem(product: CartItem): void`  
    Добавляет товар в корзину.

  - `removeItem(productId: string): void`  
    Удаляет товар из корзины по его ID.

  - `calculateTotal(): number`  
    Вычисляет и возвращает общую стоимость всех товаров в корзине.

  - `getItems(): CartItem[]`  
    Возвращает массив текущих товаров в корзине.

  - `clearCart(): void`  
    Очищает корзину.

#### Класс Order

- **Назначение**:  
  Управляет оформлением заказа, включая данные из формы, такие как способ оплаты и адрес доставки.

- **Конструктор**:  
  Инициализирует класс с пустыми данными для способа оплаты, адреса доставки, телефона и email. Также добавляется флаг для второго шага оформления заказа.

```typescript
constructor() {
    this.paymentMethod = "";
    this.deliveryAddress = "";
    this.phone = "";
    this.email = "";
    this.isSecondStep = false;
}
```

- **Поля класса**:

  - `paymentMethod` (`string`) — текущий способ оплаты.
  - `deliveryAddress` (`string`) — адрес доставки.
  - `phone` (`string`) — Номер телефона.
  - `email` (`string`) — Адрес электронной почты.
  - `isSecondStep` (`boolean`) — флаг для второго шага оформления заказа.

- **Методы класса**:

  - `setPaymentMethod(method: string): void`  
    Устанавливает способ оплаты.

  - `setDeliveryAddress(address: string): void`  
    Устанавливает адрес доставки.

  - `setPhone(phone: string): void`  
    Устанавливает номер телефона.

  - `setEmail(email: string): void`  
    Устанавливает адрес электронной почты.

  - `setIsSecondStep(isSecondStep: boolean): void`
    Устанавливает флаг для второго шага оформления заказа.

  - `validateOrder(): string[]`  
    Проверяет корректность данных заказа (адрес, способ оплаты, телефон, email). Возвращает массив ошибок (или пустой массив, если всё корректно).

---

### Слой "Представление"

#### Класс `CatalogView`

- **Назначение**:  
  Управляет отображением каталога товаров на главной странице. Управляет контейнером каталога и рендерит список разметок карточек товаров (HTML-элементы).

- **Конструктор**:  
  Принимает следующие параметры:

  - `container` (HTMLElement) — DOM-элемент, куда будет рендериться каталог.

- **Поля класса**:

  - `container` (HTMLElement) — контейнер для каталога товаров.

- **Методы класса**:

  - `renderCatalog(cards: HTMLElement[]): void`  
    Добавляет в `container` список карточек товаров (переданных как массив HTML-элементов).

  - `bindCardEvents(cards: HTMLElement[], eventHandler: (event: Event) => void): void`  
    Привязывает обработчики событий к переданным карточкам (массиву HTML-элементов), например, для открытия модального окна.

---

#### Класс `ProductCard`

- **Назначение**:  
  Отвечает за отображение одной карточки товара на главной странице. Обеспечивает создание DOM-элемента карточки и привязку событий.

- **Конструктор**:

  - `constructor(name: string, image: string, price: number, category: string)`  
    Инициализирует карточку товара с параметрами: название товара, URL изображения, цена и тег.

- **Поля класса**:

  - `name` (string) — название товара.
  - `image` (string) — URL изображения товара.
  - `price` (number) — цена товара.
  - `category` (string) — раздел, к которому относится товар.

- **Методы класса**:
  - `render(): HTMLElement`  
    Возвращает DOM-элемент карточки товара для отображения в каталоге. Включает изображение, название, цену и тег.
  - `bindEvents(): void`  
    Привязывает обработчики событий.

---

#### Класс `Modal`

- **Назначение**:  
  Класс `Modal` предназначен для отображения модальных окон. Он принимает разметку, переданную в качестве параметра, и управляет отображением и скрытием окна.

- **Конструктор**:  
  Принимает следующие параметры:

  - `content` (string | HTMLElement) — разметка или HTML-элемент, который будет отображён внутри модального окна.

- **Методы класса**:

  - `open(): void`  
    Открывает модальное окно, добавляя его в DOM и отображая на экране.
  - `close(): void`  
    Закрывает модальное окно, удаляя его из DOM.

  - `addEventListeners(): void`  
    Добавляет обработчики событий для закрытия окна по клику вне окна и по клику на крестик. Эти события будут вызваны только после открытия модального окна.

- **Поля класса**:

  - `_modalElement` (HTMLElement) — элемент модального окна, создаваемый в конструкторе.
  - `_content` (string | HTMLElement) — контент, переданный в конструктор, который будет отображён внутри модального окна.

---

#### Класс `ProductDetailView`

- **Назначение**:  
   Управляет отображением информации о конкретном товаре в модальном окне. Обеспечивает создание разметки для детальной информации о товаре и привязку событий.

- **Конструктор**:  
  Принимает следующие параметры:

  - `container` (HTMLElement) — контейнер, в который будет помещена разметка с информацией о товаре.

- **Поля класса**:

  - `container` (HTMLElement) — элемент, где отображается информация о товаре.

- **Методы класса**:

  - `render(): HTMLElement`  
    Возвращает DOM-элемент карточки товара для отображения. Включает изображение, название, цену, тег и описание.

  - `bindEvents(onAddToCart: () => void): void`  
    Привязывает обработчик события к кнопке "В корзину". Функция onAddToCart вызывается при нажатии на кнопку.

---

#### Класс `PaymentFormView`

- **Назначение**:  
  Отвечает за отображение первого шага оформления заказа, включая выбор способа оплаты и ввод адреса доставки.

- **Конструктор**:  
  Принимает следующие параметры:

  - `container` (HTMLElement) — контейнер для отображения формы выбора способа оплаты и адреса доставки.

  - `eventEmitter` (EventEmitter) — объект для управления событиями.

- **Поля класса**:

  - `container` (HTMLElement) — элемент, в котором отображается форма.
  - `paymentMethod` (HTMLElement) — текущий способ оплаты.
  - `deliveryAddress` (HTMLInputElement) — введённый адрес доставки.

  - `eventEmitter` (EventEmitter) — введённый адрес доставки.

- **Методы класса**:

  - `render(): void`  
    Отображает форму выбора способа оплаты и поля для ввода адреса доставки.

  - `setupPaymentMethodListeners(): void`  
    Устанавливает обработчики событий для выбора метода оплаты.

  - `updateNextButtonState(): void`  
    Обновляет состояние кнопки "Далее", активируя её только при выбранном способе оплаты и введённом адресе доставки.

  - `getData(): { paymentMethod: string; deliveryAddress: string }`  
    Возвращает введённые данные: способ оплаты и адрес доставки.

  - `bindEvents(onNext: Function): void`  
    Привязывает события для активации кнопки "Далее" при успешной валидации и для перехода на следующий шаг.
    - `onNext` — функция, вызываемая для перехода к следующему шагу.

---

#### Класс `ContactFormView`

- **Назначение**:  
  Отвечает за отображение второго шага оформления заказа, включая ввод email и номера телефона.

- **Конструктор**:  
  Принимает следующие параметры:

  - `container` (HTMLElement) — контейнер для отображения формы ввода контактных данных.

- **Поля класса**:

  - `container` (HTMLElement) — элемент, в котором отображается форма.
  - `email` (HTMLInputElement) — элемент для ввода адреса электронной почты.
  - `phone` (HTMLInputElement) — элемент для ввода номера телефона.

- **Методы класса**:

  - `render(): void`  
    Отображает форму ввода email и номера телефона.

  - `getData(): { email: string; phone: string }`  
    Возвращает введённые данные: email и номер телефона.

  - `updateSubmitButtonState(): void`  
    Обновляет состояние кнопки "Оплатить", проверяя валидность введённых данных (email и телефон).

  - `bindEvents(onSubmit: Function): void`  
    Привязывает события для активации кнопки "Оплатить" при успешной валидации и завершения оформления заказа.
    - `onSubmit` — функция, вызываемая для завершения оформления заказа.

---

#### Класс `CartView`

- **Назначение**:  
  Отвечает за отображение корзины товаров. Управляет контейнером корзины и рендерит список карточек товаров (HTML-элементы), а также дополнительные элементы интерфейса, такие как кнопка "Оформить" и отображение общей стоимости.

- **Конструктор**:  
  Принимает следующие параметры:

  - `container` (HTMLElement) — DOM-элемент, куда будет добавлен список товаров.

- **Поля класса**:

  - `container` (HTMLElement) — контейнер для отображения корзины.
  - `totalElement` (HTMLElement | null) — элемент для отображения общей стоимости товаров в корзине.
  - `submitButton` (HTMLElement | null) — кнопка для оформления заказа.

- **Методы класса**:

  - `renderCart(items: HTMLElement[]): void`  
    Заменяет содержимое корзины на переданные элементы (карточки товаров) и обновляет общую стоимость.

  - `bindItemEvents(items: HTMLElement[]): void`  
    Привязывает обработчики событий к переданным карточкам товаров (например, для удаления товара из корзины).

  - `updateTotal(): void`  
    Обновляет отображение общей стоимости товаров в корзине.
