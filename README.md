# Проектная работа "Веб-ларек"

<!-- Честно, сам смутно понимаю, чего я тут поналепил, очень жду ревью. -->

## Ссылка на GitHub-проект

```
https://github.com/GeorgeSGN/web-larek-frontend.git
```

## Используемый стек

Для разработки проекта используются следующие технологии:

- **JavaScript** — основной язык разработки.
- **HTML** — разметка страниц.
- **CSS/SCSS** — стилизация пользовательского интерфейса.
- **Webpack** — сборка проекта.
- **Babel** — транспиляция современного JavaScript в совместимый с более старыми браузерами.

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Слои архитектуры

Проект построен по архитектуре **MVP (Model-View-Presenter)**, которая включает следующие слои:

### Слой "Модель"

Слой модели отвечает за управление данными, взаимодействие с API и их обработку.

### Слой "Представление"

Слой представления включает классы, отвечающие за отображение данных в интерфейсе и обработку взаимодействия с пользователем.

### Слой "Презентер"

Презентер является посредником между Моделью и Представлением. Он отвечает за обработку событий из Представления, взаимодействие с Моделью и передачу данных обратно в Представление. Презентер реализуется в основном скрипте приложения, без выделения в отдельный класс.

---

## Описание классов

### Слой "Модель"

#### Класс `Api`

- **Назначение**:  
  Класс `Api` отвечает за взаимодействие с сервером через REST API. Реализует универсальные методы для отправки HTTP-запросов (GET, POST, и другие) и обработки ответов.

- **Конструктор**:  
  Принимает следующие параметры:

  - `baseUrl` (string) — базовый URL для всех запросов.
  - `options` (RequestInit, необязательный) — дополнительные параметры запроса, такие как заголовки, передаваемые в `RequestInit`. Эти параметры могут быть расширены при необходимости.

  В конструкторе создаются настройки запроса с заголовком `Content-Type: application/json` и объединяются с переданными в `options`.

- **Поля класса**:

  - `baseUrl` (string) — базовый URL для API.
  - `options` (RequestInit) — объект с настройками по умолчанию для запросов, который может быть расширен или изменен.

- **Методы класса**:
  - `get(uri: string): Promise<object>`  
    Отправляет GET-запрос на указанный URI. Возвращает Promise с распарсенным JSON-ответом.
  - `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`  
    Отправляет POST-запрос (или PUT/DELETE, если указано) с телом `data`. Возвращает Promise с результатом.
  - `handleResponse(response: Response): Promise<object>`  
    Обрабатывает ответ сервера. Если запрос успешен, возвращает распарсенный JSON, иначе отклоняет Promise с ошибкой.

---

#### Класс `EventEmitter`

- **Назначение**:  
  Класс `EventEmitter` реализует брокер событий, который используется в слое Модели для управления событиями, связанными с изменением данных и взаимодействием между слоями Модели и Представления. Позволяет подписываться на события, генерировать события и уведомлять о них другие компоненты.

- **Конструктор**:  
  Создает внутреннее поле `_events`, которое хранит карту событий и их подписчиков. Это поле инициализируется как пустая карта, где ключами являются названия событий, а значениями — множества обработчиков.

- **Поля класса**:

  - `_events` (Map<EventName, Set<Subscriber>>) — карта, где ключами являются названия событий (строка или регулярное выражение), а значениями — множества обработчиков событий.

- **Методы класса**:
  - `on<T extends object>(eventName: EventName, callback: (event: T) => void): void`  
    Добавляет обработчик `callback` для события `eventName`.
  - `off(eventName: EventName, callback: Subscriber): void`  
    Удаляет обработчик `callback` для события `eventName`. Если у события не осталось подписчиков, оно удаляется.
  - `emit<T extends object>(eventName: string, data?: T): void`  
    Инициирует событие `eventName`, передавая в него данные `data`. Вызывает все подписанные обработчики.
  - `onAll(callback: (event: EmitterEvent) => void): void`  
    Добавляет обработчик, который будет вызван для всех событий.
  - `offAll(): void`  
    Удаляет все обработчики для всех событий.
  - `trigger<T extends object>(eventName: string, context?: Partial<T>): (event: T) => void`  
    Создает функцию, которая при вызове инициирует событие `eventName` с переданными данными `context`.

---

#### Класс `Catalog`

- **Назначение**:  
  Класс отвечает за управление данными о товарах, их загрузку и предоставление доступа к данным каталога.

- **Конструктор**:  
  Инициализирует класс с пустым массивом товаров.

  ```typescript
  constructor() {
      this.products = [];
  }
  ```

- **Поля класса**:

  - `products` (Array<Product>) — массив объектов товаров, представляющих текущий каталог.

- **Методы класса**:

  - `fetchProducts(): Promise<Array<Product>>`  
    Загружает список товаров через API и сохраняет их в поле `products`. Возвращает Promise с массивом загруженных товаров.

  - `getProducts(): Array<Product>`  
    Возвращает текущий массив товаров из поля `products`.

---

#### Класс `Order`

- **Назначение**:  
  Управляет текущим заказом, включая добавление и удаление товаров, управление способом оплаты и адресом доставки.

- **Конструктор**:  
  Принимает начальные данные о заказе (по умолчанию пустые) и инициализирует поля класса.

  ```typescript
  constructor() {
      this.items = [];
      this.paymentMethod = "";
      this.deliveryAddress = "";
  }
  ```

- **Поля класса**:

  - `items` (Array<OrderItem>) — массив объектов с данными о товарах в корзине.
  - `paymentMethod` (string) — текущий способ оплаты.
  - `deliveryAddress` (string) — адрес доставки.

- **Методы класса**:

  - `addItem(productId: string): void`  
    Добавляет товар в массив `items`, если его там ещё нет.

  - `removeItem(productId: string): void`  
    Удаляет товар из массива `items` по ID.

  - `getItems(): Array<OrderItem>`  
    Возвращает массив текущих товаров в заказе.

  - `setPaymentMethod(method: string): void`  
    Устанавливает способ оплаты.

  - `setDeliveryAddress(address: string): void`  
    Устанавливает адрес доставки.

  - `validateOrder(): Array<string>`  
    Проверяет, заполнены ли обязательные поля (адрес, способ оплаты). Возвращает массив ошибок (или пустой массив, если всё корректно).

---

### Слой "Представление"

#### Класс `CatalogView`

- **Назначение**:  
  Управляет отображением каталога товаров на главной странице. Обеспечивает рендеринг карточек товаров и привязку событий для открытия модального окна с детальной информацией о товаре.

- **Конструктор**:  
  Принимает следующие параметры:

  - `catalog` (Array) — массив объектов товаров, каждый из которых содержит информацию о названии, изображении, цене и других характеристиках.

- **Поля класса**:

  - `catalog` (Array) — массив товаров для отображения в каталоге.
  - `container` (HTMLElement) — контейнер на странице, в котором будет отображаться каталог.

- **Методы класса**:

  - `renderCatalog(): void`  
    Рендерит список товаров в контейнер `container`. Каждая карточка товара создаётся с помощью класса `ProductCard`.

  - `bindCardEvents(): void`  
    Привязывает обработчики событий к карточкам товаров для открытия модального окна с информацией о выбранном товаре.

---

#### Класс `ProductDetailView`

- **Назначение**:  
  Управляет отображением информации о конкретном товаре в модальном окне. Обеспечивает создание разметки для детальной информации о товаре и привязку событий.

- **Конструктор**:  
  Принимает следующие параметры:

  - `product` (object) — объект с информацией о товаре (название, изображение, описание, цена и т.д.).

- **Поля класса**:

  - `product` (object) — объект товара, для которого создаётся разметка.
  - `container` (HTMLElement) — элемент, в который будет помещена разметка с информацией о товаре.

- **Методы класса**:

  - `render(): HTMLElement`  
    Создаёт и возвращает разметку для отображения информации о товаре.

  - `bindEvents(onBuy: Function, onRemove: Function): void`  
    Привязывает обработчики событий к кнопкам «Купить» и «Убрать».
    - `onBuy` — функция, которая вызывается при нажатии на кнопку «Купить».
    - `onRemove` — функция, которая вызывается при нажатии на кнопку «Удалить».

---

#### Класс `OrderFormView`

- **Назначение**:  
  Отвечает за отображение формы оформления заказа (оба шага). Обеспечивает ввод данных, валидацию и обработку ошибок.

- **Конструктор**:  
  Принимает следующие параметры:

  - `container` (HTMLElement) — контейнер для отображения формы заказа.
  - `steps` (Array) — массив шагов оформления заказа (объекты с полями для рендера).

- **Поля класса**:

  - `container` (HTMLElement) — элемент, в котором отображается форма заказа.
  - `currentStep` (number) — текущий шаг оформления заказа (0 — первый шаг, 1 — второй шаг).
  - `formData` (object) — объект для хранения введённых данных.

- **Методы класса**:

  - `renderStep(stepIndex: number): void`  
    Рендерит текущий шаг оформления заказа (ввод адреса, почты, телефона и выбора способа оплаты). Отображает ошибки, если поля не заполнены.

  - `validateStep(stepIndex: number): boolean`  
    Проверяет заполненность полей на текущем шаге. Если одно из обязательных полей пустое, показывает сообщение об ошибке.

  - `bindEvents(onSubmit: Function): void`  
    Привязывает события для перехода между шагами и завершения оформления заказа.

    - `onSubmit` — функция, вызываемая при успешном завершении оформления заказа.

  - `clearForm(): void`  
    Очищает форму и сбрасывает введённые данные после успешного завершения оплаты.

#### Класс `ProductCard`

- **Назначение**:  
  Отвечает за отображение одной карточки товара на главной странице. Обеспечивает создание DOM-элемента карточки и привязку событий.

- **Конструктор**:

  - `constructor(name: string, imageUrl: string, price: number, tag: string)`  
    Инициализирует карточку товара с параметрами: название товара, URL изображения, цена и тег.

- **Поля класса**:

  - `name` (string) — название товара.
  - `imageUrl` (string) — URL изображения товара.
  - `price` (number) — цена товара.
  - `tag` (string) — раздел, к которому относится товар.

- **Методы класса**:
  - `render(): HTMLElement`  
    Возвращает DOM-элемент карточки товара для отображения в каталоге. Включает изображение, название, цену и тег.
  - `bindEvents(): void`  
    Привязывает обработчики событий.

---

#### Класс `Modal`

- **Назначение**:  
  Класс `Modal` предназначен для отображения модальных окон. Он принимает разметку, переданную в качестве параметра, и управляет отображением и скрытием окна.

- **Конструктор**:  
  Принимает следующие параметры:

  - `content` (string | HTMLElement) — разметка или HTML-элемент, который будет отображён внутри модального окна.

- **Методы класса**:

  - `open(): void`  
    Открывает модальное окно, добавляя его в DOM и отображая на экране.
  - `close(): void`  
    Закрывает модальное окно, удаляя его из DOM.

  - `addEventListeners(): void`  
    Добавляет обработчики событий для закрытия окна по клику вне окна и по клику на крестик. Эти события будут вызваны только после открытия модального окна.

- **Поля класса**:

  - `_modalElement` (HTMLElement) — элемент модального окна, создаваемый в конструкторе.
  - `_content` (string | HTMLElement) — контент, переданный в конструктор, который будет отображён внутри модального окна.

---

#### Класс `CartView`

- **Назначение**:  
  Класс `Cart` отвечает за управление содержимым корзины и его оформление, отображение списка товаров, их суммы, и их удаление.

- **Конструктор**:  
  Принимает следующие параметры:

  - `cartItems` (Array) — массив товаров, добавленных в корзину. Каждый товар представляется объектом с полями: `id` (номер товара), `name` (название товара), `price` (цена товара).

- **Поля класса**:

  - `cartItems` (Array) — массив товаров в корзине.
  - `totalPrice` (number) — общая сумма товаров в корзине.
  - `modal` (Modal) — объект класса `Modal`, который отвечает за отображение корзины в модальном окне.

- **Методы класса**:

  - `addItem(item: object): void`  
    Добавляет товар в корзину. Обновляет массив `cartItems` и пересчитывает сумму.

  - `removeItem(itemId: number): void`  
    Удаляет товар из корзины по его `id`. Обновляет массив `cartItems` и пересчитывает сумму.

  - `calculateTotal(): number`  
    Пересчитывает и возвращает общую сумму всех товаров в корзине.

  - `renderCartItems(): HTMLElement`  
    Возвращает DOM-элемент, который отображает список товаров в корзине, включая номер, название, цену и кнопку для удаления товара.

  - `openCart(): void`  
    Открывает модальное окно с корзиной, передавая внутрь разметку, которая включает список товаров и общую сумму.

  - `closeCart(): void`  
    Закрывает модальное окно с корзиной.

  - `bindEvents(): void`  
    Привязывает обработчики событий для кнопок "Удалить" и "Оформить" в модальном окне корзины.

---
