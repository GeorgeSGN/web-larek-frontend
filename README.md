# Проектная работа "Веб-ларек"

## Ссылка на GitHub-проект

```
https://github.com/GeorgeSGN/web-larek-frontend.git
```

## Используемый стек

Для разработки проекта используются следующие технологии:

- **JavaScript** — основной язык разработки.
- **HTML** — разметка страниц.
- **CSS/SCSS** — стилизация пользовательского интерфейса.
- **Webpack** — сборка проекта.
- **Babel** — транспиляция современного JavaScript в совместимый с более старыми браузерами.

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Слои архитектуры

Проект построен по архитектуре **MVP (Model-View-Presenter)**, которая включает следующие слои:

### Слой "Модель"

Слой модели отвечает за управление данными, взаимодействие с API и их обработку.

### Слой "Представление"

Слой представления включает классы, отвечающие за отображение данных в интерфейсе и обработку взаимодействия с пользователем.

### Слой "Презентер"

Презентер является посредником между Моделью и Представлением. Он отвечает за обработку событий из Представления, взаимодействие с Моделью и передачу данных обратно в Представление. Презентер реализуется в основном скрипте приложения, без выделения в отдельный класс.

---

## Описание классов

### Слой "Модель"

#### Класс `Api`

- **Назначение**:\
  Класс `Api` отвечает за взаимодействие с сервером через REST API. Реализует универсальные методы для отправки HTTP-запросов (GET, POST, и другие) и обработки ответов.

- **Конструктор**:\
  Принимает следующие параметры:

  - `baseUrl` (string) — базовый URL для всех запросов.
  - `options` (RequestInit, необязательный) — дополнительные параметры запроса, такие как заголовки, передаваемые в `RequestInit`. Эти параметры могут быть расширены при необходимости.

  В конструкторе создаются настройки запроса с заголовком `Content-Type: application/json` и объединяются с переданными в `options`.

- **Поля класса**:

  - `baseUrl` (string) — базовый URL для API.
  - `options` (RequestInit) — объект с настройками по умолчанию для запросов, который может быть расширен или изменен.

- **Методы класса**:

  - `get(uri: string): Promise<object>`\
    Отправляет GET-запрос на указанный URI. Возвращает Promise с распарсенным JSON-ответом.
  - `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`\
    Отправляет POST-запрос (или PUT/DELETE, если указано) с телом `data`. Возвращает Promise с результатом.
  - `handleResponse(response: Response): Promise<object>`\
    Обрабатывает ответ сервера. Если запрос успешен, возвращает распарсенный JSON, иначе отклоняет Promise с ошибкой.

---

#### Класс `EventEmitter`

- **Назначение**:\
  Класс `EventEmitter` реализует брокер событий, который используется в слое Модели для управления событиями, связанными с изменением данных и взаимодействием между слоями Модели и Представления. Позволяет подписываться на события, генерировать события и уведомлять о них другие компоненты.

- **Конструктор**:\
  Создает внутреннее поле `_events`, которое хранит карту событий и их подписчиков. Это поле инициализируется как пустая карта, где ключами являются названия событий, а значениями — множества обработчиков.

- **Поля класса**:

  - `_events` (Map<EventName, Set>) — карта, где ключами являются названия событий (строка или регулярное выражение), а значениями — множества обработчиков событий.

- **Методы класса**:

  - `on<T extends object>(eventName: EventName, callback: (event: T) => void): void`\
    Добавляет обработчик `callback` для события `eventName`.
  - `off(eventName: EventName, callback: Subscriber): void`\
    Удаляет обработчик `callback` для события `eventName`. Если у события не осталось подписчиков, оно удаляется.
  - `emit<T extends object>(eventName: string, data?: T): void`\
    Инициирует событие `eventName`, передавая в него данные `data`. Вызывает все подписанные обработчики.
  - `onAll(callback: (event: EmitterEvent) => void): void`\
    Добавляет обработчик, который будет вызван для всех событий.
  - `offAll(): void`\
    Удаляет все обработчики для всех событий.
  - `trigger<T extends object>(eventName: string, context?: Partial<T>): (event: T) => void`\
    Создает функцию, которая при вызове инициирует событие `eventName` с переданными данными `context`.

---

#### Класс `Catalog`

- **Назначение**:\
  Управляет данными каталога товаров. Отвечает за хранение, обновление и предоставление данных о товарах.

- **Конструктор**:\
  Инициализирует класс с пустым массивом товаров.

```typescript
constructor() {
    this.products = [];
}
```

- **Поля класса**:

  - `products: Product []` — массив объектов товаров. Каждый объект `Product` представляет данные одного товара.

- **Методы класса**:

  - `setProducts(products: Product[]): void`\
    Устанавливает список товаров в каталог.

  - `getProducts(): Product[]`\
    Возвращает текущий массив объектов товаров из каталога.

---

#### Класс `Cart`

- **Назначение**:\
  Управляет данными корзины, включая добавление, удаление и вычисление итоговой стоимости товаров.

- **Конструктор**:\
  Инициализирует класс с пустым массивом товаров в корзине.

```typescript
constructor() {
    this.items = [];
}
```

- **Поля класса**:

  - `items: CartItem[]` — массив объектов корзины. Каждый объект `CartItem` содержит данные о товаре.

- **Методы класса**:

  - `addItem(product: CartItem): void`\
    Добавляет товар в корзину.

  - `removeItem(productId: string): void`\
    Удаляет товар из корзины по его ID.

  - `calculateTotal(): number`\
    Вычисляет и возвращает общую стоимость всех товаров в корзине.

  - `getItems(): CartItem[]`\
    Возвращает массив текущих товаров в корзине.

  - `clearCart(): void`\
    Очищает корзину.

---

#### Класс `Order`

- **Назначение**:\
  Управляет оформлением заказа, включая данные из формы, такие как способ оплаты и адрес доставки. Также содержит методы валидации данных заказа.

- **Конструктор**:\
  Инициализирует класс с пустыми данными для способа оплаты, адреса доставки, телефона и email.

```typescript
constructor() {
    this.paymentMethod = "";
    this.deliveryAddress = "";
    this.phone = "";
    this.email = "";
}
```

- **Поля класса**:

  - `paymentMethod` (`string`) — текущий способ оплаты.
  - `deliveryAddress` (`string`) — адрес доставки.
  - `phone` (`string`) — Номер телефона.
  - `email` (`string`) — Адрес электронной почты.

- **Методы класса**:

  - `setPaymentMethod(method: string): void`\
    Устанавливает способ оплаты.

  - `setDeliveryAddress(address: string): void`\
    Устанавливает адрес доставки.

  - `setPhone(phone: string): void`\
    Устанавливает номер телефона.

  - `setEmail(email: string): void`\
    Устанавливает адрес электронной почты.

  - `getPaymentMethod(): string`\
    Возвращает способ оплаты.

  - `getDeliveryAddress(): string`\
    Возвращает адрес доставки.

  - `getPhone(): string`\
    Возвращает номер телефона.

  - `getEmail(): string`\
    Возвращает адрес электронной почты.

  - `validateFirstStep(): string[]`\
    Проверяет наличие способа оплаты и адреса доставки. Возвращает массив ошибок.

  - `validateSecondStep(): string[]`\
    Проверяет корректность номера телефона и адреса электронной почты. Возвращает массив ошибок.

---

### Слой "Представление"

#### Класс `CatalogView`

- **Назначение**:  
  Управляет отображением каталога товаров на главной странице. Управляет контейнером каталога и рендерит список разметок карточек товаров (HTML-элементы).

- **Конструктор**:  
  Принимает следующие параметры:

  - `container` (HTMLElement) — DOM-элемент, куда будет рендериться каталог.

- **Поля класса**:

  - `container` (HTMLElement) — контейнер для каталога товаров.

- **Методы класса**:

  - `renderCatalog(cards: HTMLElement[]): void`  
    Добавляет в `container` список карточек товаров (переданных как массив HTML-элементов).

  - `bindCardEvents(cards: HTMLElement[], eventHandler: (event: Event) => void): void`  
    Привязывает обработчики событий к переданным карточкам (массиву HTML-элементов), например, для открытия модального окна.

---

#### Класс `CartView`

- **Назначение**:  
  Отвечает за отображение корзины товаров. Управляет контейнером корзины и рендерит список карточек товаров (HTML-элементы), а также дополнительные элементы интерфейса, такие как кнопка "Оформить" и отображение общей стоимости.

- **Конструктор**:  
  Принимает следующие параметры:

  - `eventEmitter` (EventEmitter) — объект для управления событиями.

- **Поля класса**:

  - `element` (HTMLElement) — контейнер корзины.
  - `listElement` (HTMLElement) — элемент для списка товаров.
  - `totalPriceElement` (HTMLElement) — элемент для отображения общей стоимости.
  - `checkoutButton` (HTMLButtonElement) — кнопка для оформления заказа.
  - `itemTemplate` (HTMLTemplateElement) — шаблон для карточки товара в корзине.
  - `eventEmitter` (EventEmitter) — объект для управления событиями.

- **Методы класса**:

  - `updateCart(itemMarkup: DocumentFragment, total: number): void`  
    Обновляет содержимое корзины, общую стоимость и состояние кнопки "Оформить".

  - `renderCartItems(itemMarkup: DocumentFragment): void`  
    Заменяет содержимое списка товаров на переданную разметку.

  - `updateTotalPrice(total: number): void`  
    Обновляет отображение общей стоимости товаров.

  - `updateCheckoutButtonState(isEnabled: boolean): void`  
    Обновляет состояние кнопки "Оформить".

  - `getElement(): HTMLElement`  
    Возвращает контейнер корзины.

---

#### Класс `CartItemView`

- **Назначение**:  
  Отвечает за отрисовку одного элемента списка корзины. Клонирует шаблон (`#card-basket`), вставляет данные о товаре и инициирует событие удаления через `EventEmitter`.

- **Конструктор**:  
  Принимает следующие параметры:

  - `item` (ICartItem) — объект товара в корзине.
  - `eventEmitter` (EventEmitter) — объект для управления событиями.

- **Поля класса**:

  - `item` (ICartItem) — объект товара.
  - `element` (HTMLElement) — корневой элемент карточки товара.
  - `eventEmitter` (EventEmitter) — объект для управления событиями.

- **Методы класса**:

  - `getElement(): HTMLElement`  
    Возвращает готовый DOM-элемент карточки товара.

---

#### Класс `Modal`

- **Назначение**:  
  Управляет отображением модального окна. Позволяет задавать содержимое окна и управлять его видимостью.

- **Конструктор**:  
  Ищет элемент с ID `modal-container` в DOM и использует его как контейнер для модального окна.

- **Поля класса**:

  - `_modalElement` (HTMLElement) — элемент контейнера модального окна.

- **Методы класса**:

  - `setContent(content: string | HTMLElement): void`  
    Устанавливает содержимое модального окна (строка или DOM-элемент).

  - `open(): void`  
    Открывает модальное окно, делая его видимым.

  - `close(): void`  
    Закрывает модальное окно, делая его невидимым.

  - `addEventListeners(): void`  
    Добавляет обработчики событий для кнопки закрытия и клика вне окна.

---

#### Класс `ProductCard`

- **Назначение**:  
  Отвечает за отображение одной карточки товара на главной странице. Обеспечивает создание DOM-элемента карточки и привязку событий.

- **Конструктор**:  
  Принимает следующие параметры:

  - `product` (Product) — объект с данными о товаре.
  - `eventEmitter` (EventEmitter) — объект для управления событиями.

- **Поля класса**:

  - `product` (Product) — объект с данными о товаре.
  - `element` (HTMLElement) — DOM-элемент карточки товара.
  - `eventEmitter` (EventEmitter) — объект для управления событиями.

- **Методы класса**:

  - `getElement(): HTMLElement`  
    Возвращает DOM-элемент карточки товара для отображения.

  - `setTitle(title: string): void`  
    Устанавливает название товара в элемент карточки.

  - `setPrice(price: number): void`  
    Устанавливает цену товара в элемент карточки.

  - `setImage(imageName: string): void`  
    Устанавливает изображение товара в элемент карточки.

  - `setCategory(category: string): void`  
    Устанавливает категорию товара в элемент карточки.

  - `getCategoryClass(category: string): string`  
    Возвращает CSS-класс для категории товара на основе её названия.

---

#### Класс `ProductDetailView`

- **Назначение**:  
  Управляет отображением информации о конкретном товаре в модальном окне. Обеспечивает создание разметки для детальной информации о товаре и привязку событий.

- **Конструктор**:  
  Создаёт контейнер для отображения детальной информации о товаре.

- **Поля класса**:

  - `element` (HTMLElement) — корневой элемент для отображения информации о товаре.
  - `addToCartButton` (HTMLButtonElement | null) — кнопка для добавления товара в корзину.

- **Методы класса**:

  - `render(product: { title: string; price: number | null; description: string; category: string; image: string; }): HTMLElement`  
    Отображает информацию о товаре в контейнере, используя HTML-шаблон `#card-preview`. Возвращает DOM-элемент с детальной информацией о товаре.

  - `bindAddToCart(onAddToCart: () => void): void`  
    Привязывает обработчик события к кнопке "В корзину". Вызывает переданный колбэк `onAddToCart` при нажатии.

  - `setIsInCart(inCart: boolean): void`  
    Управляет состоянием кнопки "В корзину". Если товар уже в корзине, кнопка становится неактивной.

  - `getCategoryClass(category: string): string`  
    Возвращает класс CSS для категории товара на основе её названия.

  - `getElement(): HTMLElement`  
    Возвращает корневой элемент с информацией о товаре.

---

#### Класс `PaymentFormView`

- **Назначение**:  
  Управляет отображением и обработкой первого шага оформления заказа, включая выбор способа оплаты и ввод адреса доставки.

- **Конструктор**:  
  Принимает объект `EventEmitter` для управления событиями и создаёт контейнер с разметкой формы из HTML-шаблона `#order`.

- **Поля класса**:

  - `container` (HTMLElement) — элемент для отображения формы.
  - `paymentMethod` (string | null) — выбранный способ оплаты.
  - `deliveryAddress` (HTMLInputElement | null) — поле для ввода адреса доставки.
  - `eventEmitter` (EventEmitter) — объект для управления событиями.
  - `nextButton` (HTMLButtonElement | null) — кнопка для перехода к следующему шагу.
  - `paymentButtons` (NodeListOf<HTMLButtonElement>) — кнопки для выбора способа оплаты.

- **Методы класса**:

  - `updateNextButtonState(): void`  
    Активирует или блокирует кнопку "Далее" в зависимости от корректности заполнения полей.

  - `setupPaymentMethodListeners(): void`  
    Настраивает обработчики событий для кнопок выбора способа оплаты.

  - `getData(): { paymentMethod: string; deliveryAddress: string }`  
    Возвращает объект с данными о способе оплаты и адресе доставки.

  - `bindEvents(onNext: () => void): void`  
    Привязывает обработчик события для отправки формы.

  - `render(): HTMLElement`  
    Возвращает DOM-элемент формы для отображения.

  - `displayErrors(errors: string[]): void`  
    Отображает текст ошибок в форме.

---

#### Класс `ContactFormView`

- **Назначение**:  
  Отвечает за отображение второго шага оформления заказа, включая ввод email и номера телефона.

- **Конструктор**:  
  Создает разметку на основе шаблона (`#contacts`) и добавляет обработчики событий для ввода и отправки данных.

- **Поля класса**:

  - `container` (HTMLElement) — элемент, в который будет вставлена форма.
  - `formElement` (HTMLFormElement | null) — форма для ввода данных.
  - `emailInput` (HTMLInputElement | null) — поле для ввода email.
  - `phoneInput` (HTMLInputElement | null) — поле для ввода телефона.
  - `formErrorsElement` (HTMLElement | null) — элемент для отображения ошибок.
  - `onInputCallback` ((email: string, phone: string) => void) — коллбек для ввода данных.
  - `onSubmitCallback` (() => void) — коллбек для отправки данных.

- **Методы класса**:

  - `setOnInput(callback: (email: string, phone: string) => void): void`  
    Устанавливает коллбек для обработки событий ввода.

  - `setOnSubmit(callback: () => void): void`  
    Устанавливает коллбек для обработки события отправки формы.

  - `show(): void`  
    Отображает форму в контейнере.

  - `updateSubmitButtonState(isValid: boolean): void`  
    Обновляет состояние кнопки "Оплатить".

  - `highlightInvalidFields(errors: string[]): void`  
    Подсвечивает поля, в которых обнаружены ошибки.

  - `displayErrors(errors: string[]): void`  
    Отображает текст ошибок в блоке ошибок.

  - `render(): HTMLElement`  
    Возвращает контейнер формы для отображения.

---

#### Класс `OrderSuccessView`

- **Назначение**:  
  Управляет отображением страницы успешного оформления заказа, включая текст с общей стоимостью и кнопку закрытия.

- **Конструктор**:  
  Создаёт контейнер с разметкой из HTML-шаблона `#success`.

- **Поля класса**:

  - `element` (HTMLElement) — корневой элемент страницы.
  - `closeButton` (HTMLButtonElement | null) — кнопка для закрытия страницы.
  - `onCloseCallback` (() => void | null) — колбэк, вызываемый при нажатии на кнопку закрытия.

- **Методы класса**:

  - `setOnClose(callback: () => void): void`  
    Устанавливает колбэк, вызываемый при нажатии на кнопку закрытия.

  - `setTotalAmount(totalAmount: number): void`  
    Устанавливает текст с общей стоимостью заказа.

  - `render(): HTMLElement`  
    Возвращает DOM-элемент страницы для отображения.

---
